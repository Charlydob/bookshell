<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Bookshell</title>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" name="viewport"/>
<!-- iOS PWA -->
<meta content="yes" name="mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="Bookshell" name="apple-mobile-web-app-title"/>
<link href="styles/mainstyles.css" rel="stylesheet"/>
<link href="styles/mainpage.css" rel="stylesheet"/><link href="styles/dashboard.css" rel="stylesheet"/>
<link href="styles/videos.css" rel="stylesheet"/>
<link href="styles/recipes.css" rel="stylesheet"/>
<link href="styles/habits.css" rel="stylesheet"/>
<link href="styles/media.css" rel="stylesheet"/>
<link href="styles/world.css" rel="stylesheet"/>
<link href="manifest.webmanifest" rel="manifest"/>
<link href="icons/favicon.ico" rel="icon"/>
<link href="icons/favicon-32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="icons/favicon-16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="icons/icon-512.png" rel="apple-touch-icon" sizes="180x180"/>
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script><script src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>

<style>
  /* Hard guarantee: solo una vista visible (evita que todo aparezca a la vez si falla JS/CSS) */
  .view{display:none !important;}
  .view.view-active{display:block !important;}
</style>

</head>
<body>
<div class="app-shell">
<header class="app-header">
<div class="header-title"></div>
</header>
<main class="app-main">
<!-- Vista LIBROS -->
<section class="view view-active" id="view-main">
<div class="dash-header">
<div>
<div class="dash-title">Hoy</div>
<div class="dash-subtitle">Tu resumen, sin rodeos.</div>
</div>
</div>
<div class="dash-grid">
<div class="dash-card">
<div class="dash-card-inner">
<div class="dash-card-head">
<div class="dash-card-title">Tiempo por hábito</div>
<div class="dash-actions">
<button class="dash-btn primary" id="dash-habit-session" type="button">Empezar sesión</button>
<button class="dash-btn" id="dash-habit-open" type="button">Abrir Hábitos</button>
</div>
</div>
<div aria-label="Rango" class="dash-chiprow" id="dash-range"></div>
<div class="dash-donut-wrap">
<div class="dash-donut" id="dash-donut"></div>
<div aria-label="Unidad de tiempo" class="dash-unit" id="dash-unit"></div>
</div>
<details class="dash-accordion">
<summary>Desglose por hábito</summary>
<div class="dash-legend" id="dash-legend"></div>
</details>
</div>
</div>
<div class="dash-card dash-shelf-card">
<div class="dash-card-inner">
<div class="dash-card-head">
<div class="dash-card-title">En marcha</div>
<div class="dash-actions">
<button class="dash-btn" id="dash-shelf-open-books" type="button">Libros</button>
<button class="dash-btn" id="dash-shelf-open-recipes" type="button">Recetas</button>
</div>
</div>
<div class="dash-shelf">
<div class="dash-shelf-side">
<div class="dash-shelf-label">Último libro</div>
<div class="dash-shelf-slot" id="dash-shelf-book"></div>
</div>
<div aria-hidden="true" class="dash-shelf-pillar"></div>
<div class="dash-shelf-side">
<div class="dash-shelf-label">Receta</div>
<div class="dash-shelf-slot" id="dash-shelf-recipe"></div>
</div>
<div aria-hidden="true" class="dash-shelf-plank"></div>
</div>
</div>
</div>
</div>
<div class="dash-card">
<div class="dash-card-inner">
<div class="dash-card-head">
<div class="dash-card-title">Último vídeo</div>
<div class="dash-actions">
<button class="dash-btn" id="dash-video-open" type="button">Editar</button>
</div>
</div>
<div class="dash-row">
<div class="dash-kpi">
<div class="kpi-value" id="dash-video-title">—</div>
<div class="kpi-label" id="dash-video-meta">—</div>
</div>
<div class="dash-actions">
<button class="dash-btn primary" id="dash-video-timer" type="button">Empezar cronómetro</button>
</div>
</div>
</div>
</div>

<div class="dash-card dash-map-card">
<div class="dash-card-inner">
<div class="dash-card-head">
<div class="dash-card-title">Mapa</div>
<div class="dash-actions">
<select class="dash-map-select" id="dash-map-select" aria-label="Elegir mapa">
<option value="media">Pantalla</option>
<option value="books">Libros</option>
<option value="recipes">Recetas</option>
<option value="world">Mundo</option></select>
</div>
</div>
<div class="dash-map-host" id="dash-map-host">
<div class="dash-map-empty" id="dash-map-empty" style="display:none;">No hay mapa aún. Abre esa pestaña una vez para inicializarlo.</div>
</div>

<div class="dash-map-breakdown-host" id="dash-map-breakdown-host">
  <div class="dash-map-breakdown-empty" id="dash-map-breakdown-empty" style="display:none">No hay desglose aún.</div>
</div>
</div>
</div>
</section></main></div>

<section class="view" id="view-books">
<!-- STATS + CALENDARIO DE LIBROS (ANTES ESTABA EN view-stats) -->
<div class="stats-wrapper">
<div class="stats-cards">
<div class="stat-card">
<div class="stat-label">Racha actual</div>
<div class="stat-value" id="stat-streak-current">0</div>
</div>
<div class="stat-card">
<div class="stat-label">Mejor racha</div>
<div class="stat-value" id="stat-streak-best">0</div>
</div>
<div class="stat-card">
<div class="stat-label">Páginas hoy</div>
<div class="stat-value" id="stat-today-pages">0</div>
</div>
<div class="stat-card">
<div class="stat-label">Páginas totales</div>
<div class="stat-value" id="stat-pages-total">0</div>
</div>
<div class="stat-card stat-card-clickable" id="stat-books-read-card">
<div class="stat-label stat-label-row">
<span>Libros leídos</span>
<select aria-label="Rango libros leídos" class="stat-range-select" id="stat-books-read-range">
<option selected="" value="total">Total</option>
<option value="month">Mes</option>
<option value="year">Año</option>
<option value="week">Semana</option>
</select>
</div>
<div class="stat-value" id="stat-books-read">0</div>
</div>
</div>
<div class="calendar-section">
<div class="calendar-header">
<div class="calendar-nav">
<button class="icon-btn" id="cal-prev">&lt;</button>
<div class="cal-label" id="cal-label"></div>
<button class="icon-btn" id="cal-next">&gt;</button>
</div>
<select aria-label="Vista del calendario" class="calendar-view-select" id="cal-view-mode">
<option selected="" value="month">Mes</option>
<option value="year">Año</option>
</select>
</div>
<div class="calendar-summary" id="calendar-summary"></div>
<div class="calendar-grid" id="calendar-grid">
<!-- Calendario por JS -->
</div>
<div class="calendar-legend">
<span class="dot dot-normal"></span> Páginas leídas
              <span class="dot dot-streak"></span> Día de racha
              <span class="dot dot-finished"></span> Libro terminado
            </div>
</div>
</div>
<!-- TOOLBAR + LISTA LIBROS -->
<div class="books-toolbar">
<button class="btn primary" id="btn-add-book">+ Añadir libro</button>
</div>
<div class="books-filters is-collapsed" id="books-filters">
<div class="books-filters-header" id="books-filters-header">
<div class="filter-row filter-search-row">
<label class="field-label" for="books-filter-search">Buscar</label>
<input autocomplete="off" class="filter-search-input" id="books-filter-search" inputmode="search" placeholder="Título, autor, categoría, idioma o siglo" type="search"/>
</div>
<button aria-controls="books-filters-body" aria-expanded="false" class="filters-toggle-btn" id="books-filters-toggle" type="button">
<span class="filters-toggle-text">Mostrar filtros</span>
<span aria-hidden="true" class="filters-toggle-icon">⌄</span>
</button>
</div>
<div class="books-filters-body" id="books-filters-body">
<div class="filter-row">
<div class="filter-label">Filtros rápidos</div>
<div aria-label="Filtros dinámicos" class="filter-chip-groups" id="books-filter-chips"></div>
</div>
<div class="filter-row filter-toggles">
<label class="toggle-pill">
<input id="books-filter-pending" type="checkbox"/>
<span>Solo pendientes</span>
</label>
<label class="toggle-pill">
<input id="books-filter-finished" type="checkbox"/>
<span>Solo terminados</span>
</label>
</div>
</div>
</div>
<details class="books-watchlist" id="books-watchlist" style="display:none;">
<summary class="watchlist-summary">
<div>
<div class="watchlist-title">Watchlist</div>
<div class="watchlist-subtitle"></div>
</div>
<div class="watchlist-summary-meta">
<span class="watchlist-count" id="books-watchlist-count">0</span>
<span aria-hidden="true" class="watchlist-caret">⌄</span>
</div>
</summary>
<div class="watchlist-body">
<div class="watchlist-empty" id="books-watchlist-empty" style="display:none;">
              No tienes libros pendientes ahora mismo.
            </div>
<div class="watchlist-list" id="books-watchlist-list"></div>
</div>
</details>
<div class="books-list" id="books-list">
<!-- Se rellenan las tarjetas por JS -->
</div>
<div class="empty-state" id="books-filter-empty" style="display:none;">
          No hay libros que coincidan con los filtros.
        </div>
<details class="books-finished" id="books-finished-section" style="display:none;">
<summary class="books-finished-summary">
<span>Terminados</span>
<span class="books-finished-count" id="books-finished-count">0</span>
</summary>
<div class="books-shelf-toolbar">
<label class="field-label shelf-search-label" for="books-shelf-search">Buscar en la estantería</label>
<input class="shelf-search-input" id="books-shelf-search" placeholder="Título, autor, idioma, categoría..." type="search"/>
<div class="books-shelf-results" id="books-shelf-results"></div>
</div>
<div class="books-shelf-empty" id="books-shelf-empty" style="display:none;">
    No hay libros que coincidan con la búsqueda.
  </div>
<div class="books-list-finished" id="books-list-finished"></div>
</details>
<section class="geo-section" id="books-geo-section" style="display:none;">
<div class="geo-card">
<div class="geo-header">
<div>
<div class="geo-title">Mapa de libros</div>
<div class="geo-subtitle">Intensidad según número de libros</div>
</div>
</div>
<div class="geo-map" id="books-world-map"></div>
<details aria-label="Listado de países (libros)" class="geo-list" id="books-country-panel">
<summary class="geo-list-summary">Países y número de libros</summary>
<div class="geo-list-body" id="books-country-list"></div>
</details>
</div>
</section>
<section class="books-charts" id="books-charts-section" style="display:none;">
<div class="chart-card">
<div class="chart-card-header">
<div class="chart-card-title" id="books-chart-title">Categoría</div>
<label class="chart-selector" for="books-chart-selector">
<span>Ver por</span>
<select class="chart-selector-input" id="books-chart-selector">
<option selected="" value="genre">Categoría</option>
<option value="author">Autor</option>
<option value="language">Idioma</option>
<option value="century">Siglo</option>
</select>
</label>
</div>
<div class="donut-host" id="chart-active"></div>
</div>
</section>
<div class="empty-state" id="books-empty">
          Aún no has añadido ningún libro.
        </div>
</section>
<!-- Vista VÍDEOS -->
<section class="view" id="view-videos">
<div class="videos-wrapper">
<!-- STATS -->
<div class="video-stats-cards">
<div class="video-stat-card">
<div class="video-stat-label">Vídeos publicados</div>
<div class="video-stat-value" id="video-stat-count">0</div>
</div>
<div class="video-stat-card">
<div class="video-stat-label">Racha días</div>
<div class="video-stat-value" id="video-stat-streak">0</div>
</div>
<div class="video-stat-card">
<div class="video-stat-label">Palabras totales</div>
<div class="video-stat-value" id="video-stat-words">0</div>
</div>
<div class="video-stat-card">
<div class="video-stat-label">Tiempo trabajado</div>
<div class="video-stat-value" id="video-stat-time">0</div>
</div>
</div>
<!-- CRONÓMETRO -->
<div class="video-timer-card">
<div class="video-timer-row">
<div class="video-timer-label">Cronómetro</div>
<button class="btn primary" id="video-timer-toggle">Empezar</button>
</div>
<div class="video-timer-time" id="video-timer-display">00:00:00</div>
<div class="video-timer-sub">
<span>Hoy: <b id="video-timer-today">0 min</b></span>
<span class="video-timer-hint" id="video-timer-hint"></span>
</div>
</div>
<!-- CALENDARIO -->
<div class="video-calendar-section">
<div class="video-calendar-header">
<div class="video-calendar-nav">
<button class="icon-btn" id="video-cal-prev">&lt;</button>
<div class="video-cal-label" id="video-cal-label"></div>
<button class="icon-btn" id="video-cal-next">&gt;</button>
</div>
<select aria-label="Vista del calendario de vídeos" class="calendar-view-select" id="video-cal-view-mode">
<option selected="" value="month">Mes</option>
<option value="year">Año</option>
</select>
</div>
<div class="calendar-summary" id="video-calendar-summary"></div>
<div class="video-calendar-grid" id="video-calendar-grid">
<!-- Rellenado por JS -->
</div>
<div class="video-calendar-legend">
<span class="video-dot video-dot-work"></span> Trabajo ese día
              <span class="video-dot video-dot-streak"></span> Día en racha
              <span class="video-dot video-dot-publish"></span> Fecha propuesta de publicación
            </div>
</div>
<!-- TOOLBAR + LISTA -->
<div class="videos-toolbar">
<button class="btn primary" id="btn-add-video">+ Añadir vídeo</button>
</div>
<div class="videos-list" id="videos-list">
<!-- Tarjetas de vídeos por JS -->
</div>
<div class="videos-empty" id="videos-empty">
            Aún no has añadido ningún vídeo.
          </div>
</div>
</section>
<!-- Vista RECETAS -->
<section class="view" id="view-recipes">
<div class="recipes-wrapper">
<div class="recipes-top">
<div class="stats-cards recipes-stats-cards">
<div class="stat-card">
<div class="stat-label">Recetas</div>
<div class="stat-value" id="recipe-stat-total">0</div>
</div>
<div class="stat-card">
<div class="stat-label">Favoritas</div>
<div class="stat-value" id="recipe-stat-favorites">0</div>
</div>
<div class="stat-card">
<div class="stat-label">Saludables</div>
<div class="stat-value" id="recipe-stat-healthy">0</div>
</div>
<div class="stat-card">
<div class="stat-label">⭐</div>
<div class="stat-value" id="recipe-stat-rating">0.0</div>
</div>
<div class="stat-card">
<div class="stat-label">L. Check</div>
<div class="stat-value" id="recipe-stat-laura-positive">0</div>
</div>
</div>
</div>
<div class="recipes-toolbar">
<button class="btn primary" id="btn-add-recipe">+ Añadir receta</button>
</div>
<div class="books-filters is-collapsed" id="recipes-filters">
<div class="books-filters-header" id="recipes-filters-header">
<div class="filter-row filter-search-row">
<label class="field-label" for="recipes-filter-search">Buscar</label>
<input autocomplete="off" class="filter-search-input" id="recipes-filter-search" inputmode="search" placeholder="Nombre del plato, etiquetas o tipo de comida" type="search"/>
</div>
<button aria-controls="recipes-filters-body" aria-expanded="false" class="filters-toggle-btn" id="recipes-filters-toggle" type="button">
<span class="filters-toggle-text">Mostrar filtros</span>
<span aria-hidden="true" class="filters-toggle-icon">⌄</span>
</button>
</div>
<div class="books-filters-body" id="recipes-filters-body">
<div class="filter-row">
<div class="filter-label">Filtros rápidos</div>
<div aria-label="Filtros dinámicos" class="filter-chip-groups" id="recipes-filter-chips"></div>
</div>
<div class="filter-row filter-toggles">
<label class="toggle-pill">
<input id="recipes-filter-favorites" type="checkbox"/>
<span>Solo favoritas</span>
</label>
<label class="toggle-pill">
<input id="recipes-filter-laura" type="checkbox"/>
<span>Con check de Laura</span>
</label>
</div>
</div>
</div>
<div class="recipes-shelf-wrapper">
<div class="recipes-shelf-toolbar">
<label class="field-label shelf-search-label" for="recipes-shelf-search">Buscar en la estantería</label>
<input class="shelf-search-input" id="recipes-shelf-search" placeholder="Nombre, tipo, etiquetas..." type="search"/>
<div class="books-shelf-results" id="recipes-shelf-results"></div>
</div>
<div class="books-shelf-empty" id="recipes-shelf-empty" style="display:none;">
              No hay recetas que coincidan con la búsqueda.
            </div>
<div class="books-list recipes-shelf" id="recipes-list"></div>
<details class="books-finished" id="recipes-favorites-section" style="display:none;">
<summary class="books-finished-summary">
<span>Favoritas</span>
<span class="books-finished-count" id="recipes-favorites-count">0</span>
</summary>
<div class="books-list-finished" id="recipes-list-favorites"></div>
</details>
</div>
<section class="geo-section" id="recipes-geo-section" style="display:none;">
<div class="geo-card">
<div class="geo-header">
<div>
<div class="geo-title">Mapa de recetas</div>
<div class="geo-subtitle">Intensidad según número de platos</div>
</div>
</div>
<div class="geo-map" id="recipes-world-map"></div>
<details aria-label="Listado de países (recetas)" class="geo-list" id="recipes-country-panel">
<summary class="geo-list-summary">Países y número de platos</summary>
<div class="geo-list-body" id="recipes-country-list"></div>
</details>
</div>
</section>
<section class="books-charts" id="recipes-charts-section">
<div class="books-charts-grid">
<div class="chart-card">
<div class="chart-card-title">Tipo de comida</div>
<div class="donut-host" id="recipe-chart-meal"></div>
</div>
<div class="chart-card">
<div class="chart-card-title">Saludable/Insana</div>
<div class="donut-host" id="recipe-chart-health"></div>
</div>
</div>
</section>
<div class="empty-state" id="recipes-empty">
            Aún no has añadido recetas.
          </div>
</div>
</section>
<!-- Vista HÁBITOS -->
<section class="view" id="view-habits">
<div class="habits-wrapper">
  <div class="botones">
  <header class="habits-header">
  <div class="habits-title"></div>
  <button aria-label="Añadir hábito" class="icon-btn icon-btn-large" id="habit-add-btn">+</button>
  </header>
<div class="habit-quick-actions">
<button class="btn ghost btn-compact" id="habit-add-time">+ Añadir tiempo</button>
</div>
</div>
<div aria-label="Vistas de hábitos" class="habits-subtabs" role="tablist">
<button aria-selected="true" class="habit-subtab is-active" data-tab="today" role="tab">Hoy</button>
<button aria-selected="false" class="habit-subtab" data-tab="week" role="tab">Semana</button>
<button aria-selected="false" class="habit-subtab" data-tab="history" role="tab">Historial</button>
<button aria-selected="false" class="habit-subtab" data-tab="reports" role="tab">Reportes</button>
</div>
<div class="habits-views">
<div class="habits-panel is-active" data-panel="today">
<details class="habit-accordion habit-today-accordion" id="habits-today-acc-count" open>
<summary>
<div class="habit-accordion-title">Contadores</div>
<div class="habit-accordion-meta" id="habits-today-count-meta">—</div>
</summary>
<div class="habit-accordion-body">
<div class="habits-subgroup">
<div class="habits-subgroup-title">Pendientes</div>
<div class="habit-card-list" id="habits-today-count-pending"></div>

<details class="habit-accordion habit-mini-group" id="habits-today-count-pending-private-wrap">
  <summary>
    <div class="habit-accordion-title">Privados</div>
    <div class="habit-accordion-meta"></div>
  </summary>
  <div class="habit-accordion-body">
    <div class="habit-card-list" id="habits-today-count-pending-private"></div>
  </div>
</details>

<details class="habit-accordion habit-mini-group" id="habits-today-count-pending-low-wrap">
  <summary>
    <div class="habit-accordion-title">Poco uso</div>
    <div class="habit-accordion-meta"></div>
  </summary>
  <div class="habit-accordion-body">
    <div class="habit-card-list" id="habits-today-count-pending-low"></div>
  </div>
</details>

<div class="empty-state small" id="habits-today-count-empty">No tienes contadores pendientes hoy.</div>
</div>
<div class="habits-subgroup">
<div class="habits-subgroup-title">Hechos</div>
<div class="habit-card-list" id="habits-today-count-done"></div>

<details class="habit-accordion habit-mini-group" id="habits-today-count-done-private-wrap">
  <summary>
    <div class="habit-accordion-title">Privados</div>
    <div class="habit-accordion-meta"></div>
  </summary>
  <div class="habit-accordion-body">
    <div class="habit-card-list" id="habits-today-count-done-private"></div>
  </div>
</details>

<details class="habit-accordion habit-mini-group" id="habits-today-count-done-low-wrap">
  <summary>
    <div class="habit-accordion-title">Poco uso</div>
    <div class="habit-accordion-meta"></div>
  </summary>
  <div class="habit-accordion-body">
    <div class="habit-card-list" id="habits-today-count-done-low"></div>
  </div>
</details>

<div class="empty-state small" id="habits-today-count-done-empty">Aún no has marcado ningún contador hoy.</div>
</div>
</div>
</details>

<details class="habit-accordion habit-today-accordion" id="habits-today-acc-time" open>
<summary>
<div class="habit-accordion-title">Por tiempo</div>
<div class="habit-accordion-meta" id="habits-today-time-meta">—</div>
</summary>
<div class="habit-accordion-body">
<div class="habits-subgroup">
<div class="habits-subgroup-title">Pendientes</div>
<div class="habit-card-list" id="habits-today-time-pending"></div>

<details class="habit-accordion habit-mini-group" id="habits-today-time-pending-private-wrap">
  <summary>
    <div class="habit-accordion-title">Privados</div>
    <div class="habit-accordion-meta"></div>
  </summary>
  <div class="habit-accordion-body">
    <div class="habit-card-list" id="habits-today-time-pending-private"></div>
  </div>
</details>

<details class="habit-accordion habit-mini-group" id="habits-today-time-pending-low-wrap">
  <summary>
    <div class="habit-accordion-title">Poco uso</div>
    <div class="habit-accordion-meta"></div>
  </summary>
  <div class="habit-accordion-body">
    <div class="habit-card-list" id="habits-today-time-pending-low"></div>
  </div>
</details>

<div class="empty-state small" id="habits-today-time-empty">No tienes hábitos pendientes hoy.</div>
</div>
<div class="habits-subgroup">
<div class="habits-subgroup-title">Hechos</div>
<div class="habit-card-list" id="habits-today-time-done"></div>

<details class="habit-accordion habit-mini-group" id="habits-today-time-done-private-wrap">
  <summary>
    <div class="habit-accordion-title">Privados</div>
    <div class="habit-accordion-meta"></div>
  </summary>
  <div class="habit-accordion-body">
    <div class="habit-card-list" id="habits-today-time-done-private"></div>
  </div>
</details>

<details class="habit-accordion habit-mini-group" id="habits-today-time-done-low-wrap">
  <summary>
    <div class="habit-accordion-title">Poco uso</div>
    <div class="habit-accordion-meta"></div>
  </summary>
  <div class="habit-accordion-body">
    <div class="habit-card-list" id="habits-today-time-done-low"></div>
  </div>
</details>

<div class="empty-state small" id="habits-today-time-done-empty">Aún no has completado ningún hábito hoy.</div>
</div>
</div>
</details>
</div>
<div class="habits-panel" data-panel="week">
<div class="habits-week-list" id="habits-week-list"></div>
<div class="empty-state small" id="habits-week-empty">Añade hábitos para empezar tu semana.</div>
</div>
<div class="habits-panel" data-panel="history">
<div class="habit-heatmap-list" id="habits-history-list"></div>
<div class="empty-state small" id="habits-history-empty">Sin historial aún.</div>
</div>
<div class="habits-panel" data-panel="reports">
<div class="habit-reports">
<div class="habit-kpi-grid">
<div class="habit-kpi-card">
<div class="habit-kpi-label">Hechos</div>
<div class="habit-kpi-value" id="habit-kpi-today">0</div>
</div>
<div class="habit-kpi-card">
<div class="habit-kpi-label">Min hoy</div>
<div class="habit-kpi-value" id="habit-kpi-minutes-today">0m</div>
</div>
<div class="habit-kpi-card">
<div class="habit-kpi-label">Sem</div>
<div class="habit-kpi-value" id="habit-kpi-minutes-week">0m</div>
</div>
<div class="habit-kpi-card">
<div class="habit-kpi-label">Mes</div>
<div class="habit-kpi-value" id="habit-kpi-minutes-month">0m</div>
</div>
<div class="habit-kpi-card">
<div class="habit-kpi-label">Año</div>
<div class="habit-kpi-value" id="habit-kpi-minutes-year">0m</div>
</div>
<div class="habit-kpi-card">
<div class="habit-kpi-label">Total</div>
<div class="habit-kpi-value" id="habit-kpi-total-time">0m</div>
</div>
<div class="habit-kpi-card">
<div class="habit-kpi-label">Días (año)</div>
<div class="habit-kpi-value" id="habit-kpi-active-days-year">0</div>
</div>
<div class="habit-kpi-card">
<div class="habit-kpi-label">Racha</div>
<div class="habit-kpi-value" id="habit-kpi-streak">0</div>
<div class="habit-kpi-sub" id="habit-kpi-streak-label">—</div>
</div>
</div>
<div class="habit-chart-card habit-donut-card">
<div class="habit-card-head">
<div>
<div class="habit-card-title" id="habit-donut-title">Tiempo por hábito</div>
<div class="habit-card-sub" id="habit-donut-sub">Distribución diaria</div>
</div>
<div class="habit-donut-controls">
<label class="habit-select habit-select-compact" for="habit-view-by">
<span>Ver por</span>
<select aria-label="Ver por" id="habit-view-by">
<option selected="" value="habits">Hábitos</option>
<option value="company">Compañía</option>
<option value="place">Lugar</option>
<option value="mode">Modo</option>
<option value="impact">Impacto</option>
<option value="money">Dinero</option>
</select>
</label>
<div aria-label="Rango de tiempo" class="habit-range-toggle" role="group">
<button class="habit-range-btn is-active" data-range="day">Día</button>
<button class="habit-range-btn" data-range="week">Semana</button>
<button class="habit-range-btn" data-range="month">Mes</button>
<button class="habit-range-btn" data-range="year">Año</button>
<button class="habit-range-btn" data-range="total">Total</button>
</div>
</div>
</div>
<div class="habit-donut-body">
<div class="habit-donut" id="habit-donut"></div>
<div class="habit-donut-center" id="habit-donut-center">
<div class="habit-donut-label" id="habit-donut-label">Tiempo</div>
<div class="habit-donut-total" id="habit-donut-total">0m</div>
<div class="habit-unit" id="habit-unit" aria-label="Unidad de tiempo"></div>
</div>
</div>
<div class="empty-state small" id="habit-donut-empty" style="display:none;">No hay datos en este rango.</div>
<div class="habit-donut-legend" id="habit-donut-legend"></div>
</div>
<div class="habit-chart-card habit-line-card" id="habit-line-card">
<div class="habit-card-head habit-line-head">
<div>
<div class="habit-card-title">Evolución (min/día)</div>
<div class="habit-card-sub" id="habit-line-sub">Últimos 7 días · Total</div>
</div>
<div class="habit-line-controls">
<label class="habit-select" for="habit-evo-select">
<span>Hábito</span>
<select aria-label="Hábito para evolución" id="habit-evo-select"></select>
</label>
<label class="habit-select habit-select-compact" for="habit-evo-range">
<span>Rango</span>
<select aria-label="Rango evolución" id="habit-evo-range">
<option selected="" value="7d">7D</option>
<option value="30d">30D</option>
<option value="90d">90D</option>
<option value="year">Año</option>
<option value="total">Total</option>
</select>
</label>
</div>
</div>
<div class="habit-line-metrics" id="habit-line-metrics">
<div class="habit-metric">
<div class="habit-metric-label">Tiempo total (rango)</div>
<div class="habit-metric-value" id="habit-line-total">0m</div>
</div>
<div class="habit-metric">
<div class="habit-metric-label">Días activos (rango)</div>
<div class="habit-metric-sub" id="habit-line-days">0</div>
</div>
</div>
<div class="habit-line-body">
<div class="habit-line-chart" id="habit-line-chart"></div>
<div class="empty-state small" id="habit-line-empty" style="display:none;">No hay datos en este rango.</div>
</div>
</div>
<div class="habit-chart-card">
<div class="habit-card-head">
<div>
<div class="habit-card-title">Heatmap global</div>
<div class="habit-card-sub" id="habit-heatmap-sub">Año actual</div>
</div>
<div class="habit-heatmap-year-switcher">
<button aria-label="Año anterior" class="icon-btn" id="habit-heatmap-prev">‹</button>
<div class="habit-year-label" id="habit-heatmap-year"></div>
<button aria-label="Año siguiente" class="icon-btn" id="habit-heatmap-next">›</button>
</div>
</div>
<div class="habit-heatmap-scroll">
<div class="habit-annual-heatmap" id="habit-global-heatmap"></div>
</div>
</div>
<details class="habit-accordion" id="habit-acc-week">
<summary>
<div class="habit-accordion-title">Top minutos (semana)</div>
<div class="habit-accordion-meta" id="habit-acc-week-meta">—</div>
</summary>
<div class="habit-accordion-body">
<div class="habit-ranking-list" id="habit-ranking-week"></div>
</div>
</details>
<details class="habit-accordion" id="habit-acc-month">
<summary>
<div class="habit-accordion-title">Top minutos (mes)</div>
<div class="habit-accordion-meta" id="habit-acc-month-meta">—</div>
</summary>
<div class="habit-accordion-body">
<div class="habit-ranking-list" id="habit-ranking-month"></div>
</div>
</details>
<div class="habit-range-toggle habit-days-range">
<button class="habit-range-btn habit-days-range-btn is-active" data-range="day">Día</button>
<button class="habit-range-btn habit-days-range-btn" data-range="week">Semana</button>
<button class="habit-range-btn habit-days-range-btn" data-range="month">Mes</button>
<button class="habit-range-btn habit-days-range-btn" data-range="year">Año</button>
<button class="habit-range-btn habit-days-range-btn" data-range="total">Total</button>
</div>
<details class="habit-accordion" id="habit-acc-total">
<summary>
<div class="habit-accordion-title">Totales por hábito</div>
<div class="habit-accordion-meta" id="habit-acc-total-meta">—</div>
</summary>
<div class="habit-accordion-body">
<div class="habit-ranking-list" id="habit-totals-list"></div>
</div>
</details>
<details class="habit-accordion" id="habit-acc-counts">
<summary>
<div class="habit-accordion-title">Contadores</div>
<div class="habit-accordion-meta" id="habit-acc-counts-meta">—</div>
</summary>
<div class="habit-accordion-body">
<div class="habit-ranking-list" id="habit-counts-list"></div>
</div>
</details>
<details class="habit-accordion" id="habit-acc-days">
<summary>
<div class="habit-accordion-title">Días hechos</div>
<div class="habit-accordion-meta" id="habit-acc-days-meta">—</div>
</summary>
<div class="habit-accordion-body">
<div class="habit-ranking-list" id="habit-days-list"></div>
</div>
</details>
<details class="habit-accordion" id="habit-acc-consistency">
<summary>
<div class="habit-accordion-title">Consistencia</div>
<div class="habit-accordion-meta" id="habit-acc-consistency-meta">—</div>
</summary>
<div class="habit-accordion-body">
<div class="habit-ranking-list" id="habit-ranking-consistency"></div>
</div>
</details>
</div>
</div>
</div>
</div>
<button class="habit-fab" id="habit-session-toggle">▶︎ Empezar sesión</button>
<div class="habit-session-overlay hidden" id="habit-session-overlay">
<div class="habit-session-pill">
<div>
<div class="habit-session-label">Sesión en curso</div>
<div class="habit-session-time" id="habit-session-time">00:00</div>
</div>
<button class="btn danger btn-compact" id="habit-session-stop">⏹ Parar</button>
</div>
</div>
</section>
<section class="view" id="view-media">
  <div class="media-wrapper">
    <div class="media-head">
      <div class="media-head-left">
        <div class="media-title">Pantalla</div>
        <div class="media-sub"></div>
      </div>

      <div class="media-viewbar" role="group" aria-label="Vista">
        <button class="media-viewbtn is-active" data-media-view="list" type="button">Lista</button>
        <button class="media-viewbtn" data-media-view="charts" type="button">Gráficos</button>
        <button class="media-viewbtn" data-media-view="map" type="button">Mapa</button>
      </div>
    </div>

    <div class="media-filters">
      <div class="media-filter-row">
        <input id="media-search" class="filter-search-input" type="search" inputmode="search"
               placeholder="Buscar título, género, país, actor, director…" autocomplete="off" />
      </div>

      <div class="media-type-pills" id="media-type-pills" aria-label="Tipo">
        <button class="media-pill is-active" data-type="all" type="button">Todo</button>
        <button class="media-pill" data-type="movie" type="button">Pelis</button>
        <button class="media-pill" data-type="series" type="button">Series</button>
        <button class="media-pill" data-type="anime" type="button">Anime</button>
      </div>

      <div class="media-filters-slot"></div>
    </div>

    <!-- FAB (centro inferior, encima del nav) -->
    <input class="media-modal-toggle" hidden id="media-add-toggle" type="checkbox" />
    <label class="media-fab" id="media-fab-add" for="media-add-toggle" role="button" aria-label="Añadir">＋</label>

    <!-- Modal: Añadir -->
    <div class="media-modal media-add-modal" aria-hidden="true">
      <label class="media-modal-backdrop" for="media-add-toggle" aria-label="Cerrar"></label>

      <div class="media-modal-sheet" role="dialog" aria-modal="true" aria-label="Añadir título">
        <div class="media-modal-head">
          <div class="media-modal-headtext">
            <div class="media-modal-title">Añadir título</div>
            <div class="media-modal-sub">Ficha rápida, datos sólidos.</div>
          </div>
          <label class="media-modal-close" for="media-add-toggle" role="button" title="Cerrar">✕</label>
        </div>

        <div class="media-modal-body">
          <label class="media-modal-field">
            <span>Título</span>
            <input id="media-title" class="media-input" placeholder="Añadir título…" autocomplete="off" />
          </label>

          <div class="media-modal-grid">
            <label class="media-modal-field">
              <span>Tipo</span>
              <select id="media-type" class="media-input">
                <option value="movie">Peli</option>
                <option value="series">Serie</option>
                <option value="anime">Anime</option>
              </select>
            </label>

            <label class="media-modal-field">
              <span>Rating</span>
              <select id="media-rating" class="media-input">
                <option value="0">0</option><option value="1">1</option><option value="2">2</option>
                <option value="3">3</option><option value="4">4</option><option value="5">5</option>
              </select>
            </label>
          </div>

          <div class="media-modal-grid">
            <label class="media-modal-field">
              <span>Año</span>
              <input id="media-year" class="media-input" type="number" inputmode="numeric" placeholder="Ej: 2024" />
            </label>

            <label class="media-modal-field">
              <span>Origen</span>
              <input id="media-country" class="media-input" list="country-options" placeholder="Ej: España" autocomplete="off" />
            </label>
          </div>

          <label class="media-modal-field">
            <span>Géneros (coma)</span>
            <input id="media-genres" class="media-input" placeholder="acción, drama…" autocomplete="off" />
          </label>

          <label class="media-modal-field">
            <span>Director</span>
            <input id="media-director" class="media-input" placeholder="Opcional" autocomplete="off" />
          </label>

          <label class="media-modal-field">
            <span>Reparto (coma)</span>
            <input id="media-cast" class="media-input" placeholder="Opcional" autocomplete="off" />
          </label>

          <div class="media-modal-toggles">
            <label class="media-check">
              <input id="media-watchlist" type="checkbox" />
              <span>Watchlist</span>
            </label>
            <label class="media-check">
              <input id="media-with-laura" type="checkbox" />
              <span>Laura</span>
            </label>
          </div>

          <div class="media-modal-grid" id="media-seasonep">
            <label class="media-modal-field">
              <span>Temporada</span>
              <input id="media-season" class="media-input" type="number" inputmode="numeric" placeholder="1" />
            </label>
            <label class="media-modal-field">
              <span>Capítulo</span>
              <input id="media-episode" class="media-input" type="number" inputmode="numeric" placeholder="1" />
            </label>
          </div>
        </div>

        <div class="media-modal-foot">
          <button class="btn ghost" id="media-add-cancel" type="button">Cancelar</button>
          <button class="btn primary" id="media-add-confirm" type="button">Guardar</button>
        </div>
      </div>
    </div>

    <!-- Charts -->
    <section class="media-chart-card" id="media-chart-card" style="display:none">
      <div class="media-chart-head">
        <div>
          <div class="media-chart-title">Distribución</div>
          <div class="media-chart-sub" id="media-chart-sub">Top 16 (sin “otros”).</div>
        </div>

        <label class="chart-selector" for="media-chart-selector">
          <span>Ver por</span>
          <select class="chart-selector-input" id="media-chart-selector">
            <option value="type" selected>Tipo</option>
            <option value="genre">Género</option>
            <option value="country">País</option>
            <option value="actor">Actor</option>
            <option value="director">Director</option>
            <option value="year">Año</option>
          </select>
        </label>
      </div>
      <div class="media-donut-host" id="media-donut"></div>

      <details class="media-legend" id="media-legend" open>
        <summary class="media-legend-summary">
          <span>Desglose</span>
          <span class="media-legend-meta" id="media-legend-meta">0</span>
        </summary>
        <div class="media-legend-body">
          <div class="media-legend-list" id="media-donut-legend"></div>
          <button class="btn ghost media-legend-more" id="media-legend-more" type="button" style="display:none">Mostrar más</button>
        </div>
      </details>

      <div class="empty-state small" id="media-chart-empty" style="display:none">Aún no hay datos.</div>
    </section>

    <!-- Map -->
    <section class="media-geo" id="media-map-card" style="display:none">
      <div class="geo-header">
        <div>
          <div class="geo-title">Mapa (origen)</div>
          <div class="geo-subtitle">Intensidad según número de títulos</div>
        </div>
      </div>

      <div class="geo-map" id="media-world-map"></div>

      <details class="geo-list" id="media-country-panel">
        <summary class="geo-list-summary">Países y número de títulos</summary>
        <div class="geo-list-body" id="media-country-list"></div>
      </details>

      <div class="media-geo-hint" id="media-map-hint" style="display:none"></div>
    </section>

    <!-- List -->
    <section class="media-list-card" id="media-list-card">
      <div class="media-list-head">
        <div class="media-list-title">Listado</div>
        <div class="media-list-meta" id="media-count">0</div>
      </div>

      <div class="media-list" id="media-list">
        <div class="media-list-spacer" id="media-list-spacer"></div>
        <div class="media-list-items" id="media-list-items"></div>
      </div>
    </section>
  </div>
</section>

<section class="view" id="view-world">
<div class="world-header">
<div class="world-kpis">
<div class="world-kpi">
<div class="label">Mundo visitado</div>
<div class="value" id="world-pct">0.00%</div>
</div>
<div class="world-kpi">
<div class="label">Países</div>
<div class="value"><span id="world-countries">0</span><span class="sub">/ <span id="world-countries-total">0</span></span></div>
</div>
<div class="world-kpi">
<div class="label">Lugares</div>
<div class="value" id="world-places">0</div>
</div>
</div>
<div class="world-controls">
<select id="world-filter">
<option value="day">Día</option>
<option value="week">Semana</option>
<option value="month">Mes</option>
<option value="year">Año</option>
<option selected="" value="total">Total</option>
</select>
<label class="btn primary" for="world-add-toggle">+ Añadir</label>
</div>
</div>
<div class="world-map-wrap">
<div id="world-map"></div>
</div>
<div class="world-bottom"><details class="world-card"><summary class="world-summary"><h3>Últimas visitas</h3><span class="world-count" id="world-visits-count">0</span></summary><div class="world-list" id="world-visits-list"></div></details><details class="world-card"><summary class="world-summary"><h3>Watchlist</h3><span class="world-count" id="world-watch-count">0</span></summary><div class="world-list"><div class="world-watch-row"><input autocomplete="off" id="world-watch-q" placeholder="Añadir país a watchlist…" type="search"/><button class="btn primary" id="world-watch-add" type="button">Añadir</button></div><div class="world-list" id="world-watch-list"></div></div></details></div>
<!-- Modal toggle + modal -->
<input class="world-modal-toggle" hidden="" id="world-add-toggle" type="checkbox"/>
<div class="world-modal">
<label class="world-modal-backdrop" for="world-add-toggle"></label>
<div class="world-modal-sheet">
<div class="world-modal-header">
<div class="title">Añadir visita</div>
<label class="btn" for="world-add-toggle">Cerrar</label>
</div>
<div class="world-modal-grid">
<select id="world-kind">
<option value="country">País</option>
<option selected="" value="city">Ciudad</option>
<option value="town">Pueblo</option>
</select>
<input autocomplete="off" id="world-place-q" placeholder="Buscar (usa el mapa del mundo real)..."/>
<div class="world-list" id="world-place-results"></div>
<div class="world-modal-actions">
<button class="btn primary" id="world-place-save" type="button">Guardar</button>
</div>
</div>
</div>
</div>
</section>

<nav class="bottom-nav"><button class="nav-btn nav-btn-active" data-view="view-main">Inicio</button>
<button class="nav-btn" data-view="view-books">Libros</button>
<button class="nav-btn" data-view="view-videos">Vídeos</button>
<button class="nav-btn" data-view="view-recipes">Recetas</button>
<button class="nav-btn" data-view="view-habits">Hábitos</button>
<button class="nav-btn" data-view="view-media">Media</button>
<button class="nav-btn" data-view="view-world">Mundo</button>
</nav>

<!-- MODAL LIBRO -->
<div class="modal-backdrop hidden" id="book-modal-backdrop">
<div class="modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title" id="book-modal-title">Nuevo libro</div>
<button class="icon-btn" id="book-modal-close">✕</button>
</div>
<form class="modal-form" id="book-form">
<input id="book-id" type="hidden"/>
<div class="modal-scroll sheet-body">
<div class="sheet-section">
<div class="sheet-section-title">Detalles</div>
<div class="field">
<span class="field-label">ISBN</span>
<div class="isbn-input-row">
<input autocomplete="off" id="book-isbn" inputmode="numeric" placeholder="978..." type="text"/>
<button class="btn ghost btn-compact" id="book-isbn-search" type="button">Buscar</button>
</div>
<div class="isbn-status" id="book-isbn-status">Autocompleta título, autor, año y páginas.</div>
<div class="isbn-results" id="book-isbn-results" style="display:none;"></div>
</div>
<label class="field">
<span class="field-label">Título</span>
<input id="book-title" required="" type="text"/>
</label>
<label class="favorite-toggle">
<input id="book-favorite" type="checkbox"/>
<span aria-hidden="true" class="favorite-icon">★</span>
<span>Marcar como favorito</span>
</label>
<div class="form-grid row-2">
<label class="field">
<span class="field-label">Autor</span>
<input id="book-author" type="text"/>
</label>
<label class="field">
<span class="field-label">Año</span>
<input id="book-year" inputmode="numeric" type="number"/>
</label>
</div>
<div class="form-grid row-2">
<label class="field">
<span class="field-label">Categoría</span>
<div class="field-inline">
<select aria-label="Categoría" id="book-genre">
<option value="">—</option>
</select>
<button aria-label="Eliminar categoría" class="icon-btn genre-remove-btn" id="genre-remove-btn" type="button">−</button>
<button aria-label="Añadir categoría" class="icon-btn genre-add-btn" id="genre-add-btn" type="button">+</button>
</div>
</label>
<label class="field">
<span class="field-label">Idioma</span>
<input id="book-language" type="text"/>
</label>
</div>
<label class="field">
<span class="field-label">País / origen</span>
<input id="book-country" list="country-options" placeholder="España, México, Estados Unidos..." type="text"/>
</label>
</div>
<div class="sheet-section">
<div class="sheet-section-title">Progreso</div>
<div class="form-grid row-2">
<label class="field">
<span class="field-label">N.º páginas</span>
<input id="book-pages" inputmode="numeric" min="1" required="" type="number"/>
</label>
<label class="field">
<span class="field-label">Página actual</span>
<input id="book-current-page" inputmode="numeric" min="0" type="number" value="0"/>
</label>
</div>
<label class="field">
<span class="field-label">Estado</span>
<select id="book-status">
<option value="reading">Leyendo</option>
<option value="planned">Pendiente</option>
<option value="finished">Terminado</option>
</select>
</label>
<label class="field checkbox-field">
<div class="checkbox-field-row">
<div>
<div class="checkbox-field-title">Leído en el pasado</div>
<div class="checkbox-field-hint">No registrará fecha de finalización</div>
</div>
<input id="book-finished-past" type="checkbox"/>
</div>
</label>
</div>
</div>
<div class="modal-footer sheet-footer">
<button class="btn ghost" id="book-modal-cancel" type="button">Cancelar</button>
<button class="btn primary" type="submit">Guardar</button>
</div>
</form>
</div>
</div>
<!-- FICHA LIBRO -->
<div class="modal-backdrop hidden" id="book-detail-backdrop">
<div class="modal book-detail-modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title" id="book-detail-title">Ficha del libro</div>
<button class="icon-btn" id="book-detail-close">✕</button>
</div>
<div class="modal-body book-detail-body">
<div class="book-detail-top">
<label class="favorite-toggle">
<input id="book-detail-favorite" type="checkbox"/>
<span aria-hidden="true" class="favorite-icon">★</span>
<span>Favorito</span>
</label>
<div class="book-detail-status" id="book-detail-status"></div>
</div>
<div class="spec-block compact">
<div class="spec-block-title">Datos rápidos</div>
<div class="spec-grid">
<div class="spec-item">
<span class="spec-label">Autor</span>
<div class="spec-value" id="book-detail-author">—</div>
</div>
<div class="spec-item">
<span class="spec-label">Año</span>
<div class="spec-value" id="book-detail-year">—</div>
</div>
<div class="spec-item">
<span class="spec-label">Siglo</span>
<div class="spec-value" id="book-detail-century">—</div>
</div>
<div class="spec-item">
<span class="spec-label">Género</span>
<div class="spec-value" id="book-detail-genre">—</div>
</div>
<div class="spec-item">
<span class="spec-label">Idioma</span>
<div class="spec-value" id="book-detail-language">—</div>
</div>
<div class="spec-item">
<span class="spec-label">País</span>
<div class="spec-value" id="book-detail-country">—</div>
</div>
<div class="spec-item">
<span class="spec-label">Páginas</span>
<div class="spec-value" id="book-detail-pages">—</div>
</div>
<div class="spec-item">
<span class="spec-label">Progreso</span>
<div class="spec-value" id="book-detail-progress">—</div>
</div>
<div class="spec-item">
<span class="spec-label">Finalizado</span>
<div class="spec-value" id="book-detail-finished">—</div>
</div>
<div class="spec-item spec-notes">
<span class="spec-label">Notas</span>
<div class="spec-value" id="book-detail-notes">Sin notas</div>
</div>
</div>
</div>
</div>
<div class="modal-footer book-detail-footer sticky-footer">
<button class="btn primary btn-compact" id="book-detail-edit" type="button">Editar</button>
<button class="btn ghost" id="book-detail-close-btn" type="button">Cerrar</button>
</div>
</div>
</div>
<!-- MODAL VÍDEO -->
<div class="modal-backdrop hidden" id="video-modal-backdrop">
<div class="modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title" id="video-modal-title">Nuevo vídeo</div>
<button class="icon-btn" id="video-modal-close">✕</button>
</div>
<form class="modal-form" id="video-form">
<input id="video-id" type="hidden"/>
<div class="modal-scroll sheet-body">
<div class="sheet-section">
<div class="sheet-section-title">Básico</div>
<label class="field">
<span class="field-label">Título</span>
<input id="video-title" required="" type="text"/>
</label>
<label class="field">
<span class="field-label">Palabras de guion <em class="hint">(objetivo 2000)</em></span>
<input id="video-script-words" inputmode="numeric" min="0" type="number" value="0"/>
</label>
</div>
<div class="sheet-section">
<div class="sheet-section-title">Duración</div>
<div class="form-grid row-2">
<label class="field">
<span class="field-label">Total</span>
<div class="time-split">
<input class="time-input" id="video-duration-min" inputmode="numeric" min="0" placeholder="min" type="number"/>
<span class="time-sep">:</span>
<input class="time-input" id="video-duration-sec" inputmode="numeric" max="59" min="0" placeholder="seg" type="number"/>
</div>
</label>
<label class="field">
<span class="field-label">Editado</span>
<div class="time-split">
<input class="time-input" id="video-edited-min" inputmode="numeric" min="0" placeholder="min" type="number"/>
<span class="time-sep">:</span>
<input class="time-input" id="video-edited-sec" inputmode="numeric" max="59" min="0" placeholder="seg" type="number"/>
</div>
</label>
</div>
</div>
<div class="sheet-section">
<div class="sheet-section-title">Plan</div>
<div class="form-grid row-2">
<label class="field">
<span class="field-label">Fecha propuesta</span>
<input id="video-publish-date" type="date"/>
</label>
<label class="field">
<span class="field-label">Estado</span>
<select id="video-status">
<option value="in_progress">Curso</option>
<option value="planned">Planificado</option>
<option value="published">Publicado</option>
</select>
</label>
</div>
</div>
</div>
<div class="modal-footer sheet-footer">
<button class="btn ghost" id="video-modal-cancel" type="button">Cancelar</button>
<button class="btn primary" type="submit">Guardar</button>
</div>
</form>
</div>
</div>
<!-- MODAL ASIGNAR TIEMPO A VÍDEO -->
<div class="modal-backdrop hidden" id="assign-work-backdrop">
<div class="modal">
<div class="modal-header">
<div class="modal-title">¿En qué vídeo has trabajado?</div>
<button class="icon-btn" id="assign-work-close">✕</button>
</div>
<div class="modal-body">
<div id="assign-work-summary" style="opacity:.75; margin-bottom:10px;"></div>
<label class="field">
<span>Vídeo</span>
<select id="assign-work-select"></select>
</label>
</div>
<div class="modal-footer">
<button class="btn ghost" id="assign-work-skip" type="button">No asignar</button>
<button class="btn primary" id="assign-work-save" type="button">Asignar</button>
</div>
</div>
</div>
<!-- MODAL RECETA -->
<div class="modal-backdrop hidden" id="recipe-modal-backdrop">
<div class="modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title" id="recipe-modal-title">Nueva receta</div>
<button class="icon-btn" id="recipe-modal-close">✕</button>
</div>
<form class="modal-form" id="recipe-form">
<input id="recipe-id" type="hidden"/>
<div class="modal-scroll sheet-body">
<div class="sheet-section">
<div class="sheet-section-title">Datos clave</div>
<div class="recipe-import">
<button class="btn ghost btn-compact" id="recipe-import-toggle" type="button">
    Importar
  </button>
<div class="recipe-import-box hidden" id="recipe-import-box">
<textarea class="builder-textarea recipe-import-text" id="recipe-import-text" placeholder="Pega aquí el bloque RECETA_V1… (desde ChatGPT)" rows="7"></textarea>
<div class="recipe-import-actions">
<button class="btn primary btn-compact" id="recipe-import-btn" type="button">Aplicar</button>
<button class="btn ghost btn-compact" id="recipe-import-clear" type="button">Limpiar</button>
<div class="recipe-import-status" id="recipe-import-status"></div>
</div>
</div>
</div>
<label class="field">
<span class="field-label">Nombre del plato</span>
<input id="recipe-name" required="" type="text"/>
</label>
<div class="form-grid row-2">
<label class="field">
<span class="field-label">Tipo de comida</span>
<select id="recipe-meal" required="">
<option value="desayuno">Desayuno</option>
<option value="comida">Comida</option>
<option value="cena">Cena</option>
<option value="snack">Snack</option>
</select>
</label>
<label class="field">
<span class="field-label">Saludable</span>
<select id="recipe-health" required="">
<option value="sana">Sana</option>
<option value="equilibrada">Equilibrada</option>
<option value="insana">Insana</option>
</select>
</label>
</div>
<label class="field">
<span class="field-label">Etiquetas (separadas por coma)</span>
<input id="recipe-tags" placeholder="rápida, horno, pasta..." type="text"/>
</label>
<label class="field">
<span class="field-label">País / origen</span>
<input id="recipe-country" list="country-options" placeholder="Italia, Perú, Estados Unidos..." type="text"/>
</label>
<div class="field recipe-photo-field">
  <span class="field-label">Foto</span>
  <div class="recipe-photo-wrap">
    <img id="recipe-image-preview" class="recipe-photo-preview" alt="Foto de la receta" />
    <div class="recipe-photo-actions">
      <button class="btn ghost btn-compact" id="recipe-image-camera" type="button">📷 Cámara</button>
      <button class="btn ghost btn-compact" id="recipe-image-gallery" type="button">🖼️ Galería</button>
      <button class="btn ghost danger btn-compact" id="recipe-image-remove" type="button">Quitar</button>
    </div>
    <div class="hint recipe-photo-status" id="recipe-image-status"></div>
    <input id="recipe-image-file" type="file" accept="image/*" hidden />
  </div>
</div>

<div class="form-grid row-2">
<label class="field">
<span class="field-label">Valoración</span>
<input id="recipe-rating" max="5" min="0" step="0.5" type="number" value="4"/>
</label>
<label class="field">
<span class="field-label">Última vez cocinada</span>
<input id="recipe-last-cooked" type="date"/>
</label>
</div>
<label class="field">
<span class="field-label">Notas</span>
<textarea id="recipe-notes" placeholder="Notas rápidas, truco o acompañamiento..." rows="3"></textarea>
</label>
<div class="form-grid row-2">
<label class="favorite-toggle">
<input id="recipe-favorite" type="checkbox"/>
<span aria-hidden="true" class="favorite-icon">★</span>
<span>Marcar como favorita</span>
</label>
<label class="laura-check">
<input id="recipe-laura" type="checkbox"/>
<span aria-hidden="true" class="laura-check-mark"></span>
<span>Aprobación de Laura</span>
</label>
</div>
</div>
<div class="sheet-section">
<div class="sheet-section-title">Receta editable</div>
<p class="section-hint">Organiza ingredientes y pasos para que aparezcan en el recetario a pantalla completa.</p>
<div class="recipe-builder-grid">
<div class="recipe-builder-column">
<div class="builder-header">
<div>
<div class="builder-title">Ingredientes</div>
<div class="builder-subtitle">Añade tantos como necesites</div>
</div>
<button class="btn ghost btn-compact" id="recipe-add-ingredient" type="button">+ Ingrediente</button>
</div>
<div class="recipe-ingredients-list" id="recipe-ingredients-list"></div>
</div>
<div class="recipe-builder-column">
<div class="builder-header">
<div>
<div class="builder-title">Pasos</div>
<div class="builder-subtitle">Título y descripción para cada paso</div>
</div>
<button class="btn ghost btn-compact" id="recipe-add-step" type="button">+ Paso</button>
</div>
<div class="recipe-steps-list" id="recipe-steps-list"></div>
</div>
</div>
</div>
</div>
<div class="modal-footer sheet-footer">
<button class="btn ghost danger footer-start" id="recipe-delete" type="button">Eliminar</button>
<button class="btn ghost" id="recipe-modal-cancel" type="button">Cancelar</button>
<button class="btn primary" type="submit">Guardar</button>
</div>
</form>
</div>
</div>
<!-- RECETARIO A PANTALLA COMPLETA -->
<div class="recipe-detail-backdrop hidden" id="recipe-detail-backdrop">
<article aria-modal="true" class="recipe-detail-card" role="dialog">
<header class="recipe-detail-header">
<div class="recipe-detail-top">
<div class="recipe-detail-headings">
<h2 class="recipe-detail-title" id="recipe-detail-title">Receta</h2>
<div class="recipe-detail-chips">
<div class="recipe-detail-chip" id="recipe-detail-meal"></div>
<div class="recipe-detail-tags" id="recipe-detail-tags"></div>
</div>
</div>
<div class="recipe-detail-actions">
<button aria-label="Seguimiento" class="icon-btn icon-btn-large recipe-bookmark-btn" id="recipe-detail-bookmark">🔖</button>
<button aria-label="Cerrar" class="icon-btn icon-btn-large" id="recipe-detail-close">✕</button>
</div>
</div>
<div class="recipe-detail-hero" id="recipe-detail-hero" style="display:none;">
  <img id="recipe-detail-image" alt="Foto de la receta" loading="lazy" />
</div>
<div class="recipe-detail-specs">
<div class="spec-block">
<div class="spec-block-title">Datos rápidos</div>
<div class="spec-grid" id="recipe-detail-meta"></div>
</div>
<div class="spec-block">
<div class="spec-block-title">Datos clave</div>
<div class="spec-grid spec-grid-secondary" id="recipe-detail-grid"></div>
</div>
</div>
</header>
<div class="recipe-detail-body">
<div aria-label="Contenido de la receta" class="recipe-detail-tabbar" id="recipe-detail-tabbar" role="tablist">
<button aria-selected="true" class="recipe-tab is-active" data-target="ingredients" role="tab" type="button">Ingredientes</button>
<button aria-selected="false" class="recipe-tab" data-target="steps" role="tab" type="button">Pasos</button>
</div>
<section class="recipe-detail-section recipe-detail-panel is-active" data-panel="ingredients" role="tabpanel">
<div class="section-subtitle">Marca al preparar</div>
<div class="recipe-detail-ingredients" id="recipe-detail-ingredients"></div>
</section>
<section aria-hidden="true" class="recipe-detail-section recipe-detail-panel" data-panel="steps" role="tabpanel">
<div class="section-subtitle">Solo una lista visible</div>
<div class="recipe-detail-steps" id="recipe-detail-steps"></div>
</section>
<section class="recipe-detail-section recipe-notes-section" id="recipe-detail-notes-wrapper" style="display:none;">
<div class="spec-block-title">Notas</div>
<p class="recipe-detail-notes" id="recipe-detail-notes"></p>
</section>
</div>
<div class="recipe-detail-actions-bar">
<button class="btn primary btn-compact" id="recipe-detail-edit">Editar</button>
<button class="btn ghost danger btn-compact" id="recipe-detail-delete">Eliminar</button>
<button class="btn ghost" id="recipe-detail-close-bottom">Cerrar</button>
</div>
</article>
</div>
<!-- MODAL HÁBITO -->
<div class="modal-backdrop hidden" id="habit-modal-backdrop">
<div class="modal habit-modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title" id="habit-modal-title">Nuevo hábito</div>
<button class="icon-btn" id="habit-modal-close">✕</button>
</div>
<form class="modal-form" id="habit-form">
<input id="habit-id" type="hidden"/>
<div class="modal-scroll sheet-body">
<div class="sheet-section">
<div class="sheet-section-title">Detalles</div>
<label class="field">
<span class="field-label">Nombre</span>
<input id="habit-name" required="" type="text"/>
</label>
<label class="field">
<span class="field-label">Emoji/Icono</span>
<input id="habit-emoji" inputmode="text" maxlength="4" placeholder="💪" type="text"/>
</label>
<label class="field">
<span class="field-label">Color</span>
<input id="habit-color" type="color" value="#7f5dff"/>
</label>

<label class="field checkbox-field">
  <div class="checkbox-field-row">
    <div>
      <div class="checkbox-field-title">Agrupar en “Privados”</div>
      <div class="checkbox-field-hint">Se mostrará en un desplegable cerrado por defecto (en Pendientes/Hechos).</div>
    </div>
    <input id="habit-group-private" type="checkbox"/>
  </div>
</label>

<label class="field checkbox-field">
  <div class="checkbox-field-row">
    <div>
      <div class="checkbox-field-title">Agrupar en “Poco uso”</div>
      <div class="checkbox-field-hint">Se mostrará en un desplegable cerrado por defecto (en Pendientes/Hechos).</div>
    </div>
    <input id="habit-group-lowuse" type="checkbox"/>
  </div>
</label>

</div>
<div class="sheet-section">
<div class="sheet-section-title">Objetivo</div>
<div class="field">
<span class="field-label">Tipo</span>
<div class="pill-row">
<label class="toggle-pill">
<input checked="" name="habit-goal" type="radio" value="check"/>
<span>Check</span>
</label>
<label class="toggle-pill">
<input name="habit-goal" type="radio" value="time"/>
<span>Tiempo</span>
</label>
<label class="toggle-pill">
<input name="habit-goal" type="radio" value="count"/>
<span>Conteo</span>
</label>
</div>
</div>
<label class="field" id="habit-target-minutes-wrap">
<span class="field-label">Minutos objetivo (opcional)</span>
<input id="habit-target-minutes" inputmode="numeric" min="0" placeholder="25" type="number"/>
</label>
<label class="field" id="habit-count-unit-minutes-wrap" style="display:none">
  <span class="field-label">Minutos por vez (opcional)</span>
  <input id="habit-count-unit-minutes" inputmode="numeric" min="0" placeholder="8" type="number"/>
  <div class="checkbox-field-hint">Si pones 8 y cuentas 2, se registran 16m ese día.</div>
</label>

<div class="sheet-subsection" id="habit-quick-adds-wrap" style="display:none">
  <div class="sheet-section-title">Atajos</div>
  <div class="quick-add-grid">
    <label class="field">
      <span class="field-label">Botón 1 (texto)</span>
      <input id="habit-quick1-label" placeholder="+3 min" autocomplete="off"/>
    </label>
    <label class="field">
      <span class="field-label">Botón 1 (min)</span>
      <input id="habit-quick1-minutes" inputmode="numeric" min="0" placeholder="3" type="number"/>
    </label>
    <label class="field">
      <span class="field-label">Botón 2 (texto)</span>
      <input id="habit-quick2-label" placeholder="+1 h" autocomplete="off"/>
    </label>
    <label class="field">
      <span class="field-label">Botón 2 (min)</span>
      <input id="habit-quick2-minutes" inputmode="numeric" min="0" placeholder="60" type="number"/>
    </label>
  </div>
</div>

</div>
<div class="sheet-section">
<div class="sheet-section-title">Frecuencia</div>
<div class="pill-row">
<label class="toggle-pill">
<input checked="" name="habit-schedule" type="radio" value="daily"/>
<span>Cada día</span>
</label>
<label class="toggle-pill">
<input name="habit-schedule" type="radio" value="days"/>
<span>Días concretos</span>
</label>
</div>
<div class="habit-days-selector" id="habit-days-selector">
<button data-day="1" type="button">L</button>
<button data-day="2" type="button">M</button>
<button data-day="3" type="button">X</button>
<button data-day="4" type="button">J</button>
<button data-day="5" type="button">V</button>
<button data-day="6" type="button">S</button>
<button data-day="0" type="button">D</button>
</div>
</div>
<details class="habit-accordion habit-facets-accordion">
<summary>
<div class="habit-accordion-title">Clasificación</div>
</summary>
<div class="habit-accordion-body">
<div class="habit-facet-row">
<div class="habit-facet-label">Compañía</div>
<div class="habit-facet-options">
<button class="habit-facet-chip" data-facet="company" data-value="solo" type="button">Solo</button>
<button class="habit-facet-chip" data-facet="company" data-value="laura" type="button">Con Laura</button>
<button class="habit-facet-chip" data-facet="company" data-value="others" type="button">Con otros</button>
</div>
</div>
<div class="habit-facet-row">
<div class="habit-facet-label">Lugar</div>
<div class="habit-facet-options">
<button class="habit-facet-chip" data-facet="place" data-value="home" type="button">Casa</button>
<button class="habit-facet-chip" data-facet="place" data-value="away" type="button">Fuera</button>
<button class="habit-facet-chip" data-facet="place" data-value="mixed" type="button">Mixto</button>
</div>
</div>
<div class="habit-facet-row">
<div class="habit-facet-label">Modo</div>
<div class="habit-facet-options">
<button class="habit-facet-chip" data-facet="mode" data-value="obligation" type="button">Obligación</button>
<button class="habit-facet-chip" data-facet="mode" data-value="hobby" type="button">Hobby</button>
</div>
</div>
<div class="habit-facet-row">
<div class="habit-facet-label">Impacto</div>
<div class="habit-facet-options">
<button class="habit-facet-chip" data-facet="impact" data-value="productive" type="button">Productivo</button>
<button class="habit-facet-chip" data-facet="impact" data-value="leisure" type="button">Ocio</button>
<button class="habit-facet-chip" data-facet="impact" data-value="selfcare" type="button">Autocuidado</button>
</div>
</div>
<div class="habit-facet-row">
<div class="habit-facet-label">Dinero</div>
<div class="habit-facet-options">
<button class="habit-facet-chip" data-facet="money" data-value="earns" type="button">Genera</button>
<button class="habit-facet-chip" data-facet="money" data-value="spends" type="button">Gasta</button>
<button class="habit-facet-chip" data-facet="money" data-value="neutral" type="button">Neutro</button>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="modal-footer sheet-footer">
<button class="btn ghost danger footer-start" id="habit-delete" type="button">Eliminar hábito</button>
<button class="btn ghost" id="habit-modal-cancel" type="button">Cancelar</button>
<button class="btn primary" type="submit">Guardar</button>
</div>
</form>
</div>
</div>
<!-- MODAL ASIGNAR SESIÓN -->
<div class="modal-backdrop hidden" id="habit-session-modal">
<div class="modal habit-session-modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title">¿A qué hábito asignas esta sesión?</div>
<button class="icon-btn" id="habit-session-close">✕</button>
</div>
<div class="modal-scroll sheet-body">
<div class="field">
<span class="field-label">Buscar</span>
<input id="habit-session-search" placeholder="Nombre del hábito" type="search"/>
</div>
<div class="habit-session-last" id="habit-session-last" style="display:none;"></div>
<div class="habit-session-list" id="habit-session-list"></div>
</div>
<div class="modal-footer sheet-footer">
<button class="btn ghost" id="habit-session-cancel">Cancelar</button>
</div>
</div>
</div>
<!-- MODAL TIEMPO MANUAL -->
<div class="modal-backdrop hidden" id="habit-manual-modal">
<div class="modal habit-modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title">Añadir tiempo</div>
<button class="icon-btn" id="habit-manual-close">✕</button>
</div>
<form class="modal-form" id="habit-manual-form">
<div class="modal-scroll sheet-body">
<div class="sheet-section">
<div class="sheet-section-title">Sesión manual</div>
<label class="field">
<span class="field-label">Hábito</span>
<select id="habit-manual-habit" required=""></select>
</label>
<label class="field">
<span class="field-label">Minutos</span>
<input id="habit-manual-minutes" inputmode="numeric" min="1" placeholder="25" required="" type="number"/>
</label>
<label class="field">
<span class="field-label">Fecha</span>
<input id="habit-manual-date" type="date"/>
</label>
</div>
</div>
<div class="modal-footer sheet-footer">
<button class="btn ghost" id="habit-manual-cancel" type="button">Cancelar</button>
<button class="btn primary" type="submit">Guardar</button>
</div>
</form>
</div>
</div>
<!-- MODAL EDITAR REGISTROS -->
<div class="modal-backdrop hidden" id="habit-entry-modal-backdrop">
<div class="modal habit-modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title">Editar registros</div>
<button class="icon-btn" id="habit-entry-close">✕</button>
</div>
<form class="modal-form" id="habit-entry-form">
<div class="modal-scroll sheet-body">
<div class="sheet-section">
<div class="sheet-section-title">Día</div>
<label class="field">
<span class="field-label">Hábito</span>
<select id="habit-entry-habit" required=""></select>
</label>
<label class="field">
<span class="field-label">Fecha</span>
<input id="habit-entry-date" required="" type="date"/>
</label>
<div id="habit-entry-check-wrap">
<label class="field">
<span class="field-label">Check</span>
<input id="habit-entry-check" type="checkbox"/>
</label>
</div>
<div id="habit-entry-count-wrap" style="display:none;">
<div class="field">
<span class="field-label">Conteo</span>
<div class="pill-row">
<button class="icon-btn" id="habit-entry-count-minus" type="button">−</button>
<input id="habit-entry-count" inputmode="numeric" min="0" type="number" value="0"/>
<button class="icon-btn" id="habit-entry-count-plus" type="button">+</button>
</div>
</div>
</div>
</div>
<div class="sheet-section">
<div class="sheet-section-title">Sesiones (tiempo)</div>
<div id="habit-entry-sessions"></div>
<div class="hint">Puedes ajustar minutos o borrar sesiones. Para añadir una nueva, usa “Añadir tiempo”.</div>
</div>
</div>
<div class="modal-footer sheet-footer">
<button class="btn ghost" id="habit-entry-cancel" type="button">Cancelar</button>
<button class="btn primary" type="submit">Guardar</button>
</div>
</form>
</div>
</div>
<!-- CONFIRMAR ELIMINACIÓN HÁBITO -->
<div class="modal-backdrop hidden" id="habit-delete-confirm">
<div class="modal habit-modal">
<div class="modal-handle"></div>
<div class="modal-header">
<div class="modal-title">Eliminar hábito</div>
<button class="icon-btn" id="habit-delete-close">✕</button>
</div>
<div class="modal-body sheet-body">
<p>Vas a archivar el hábito <strong id="habit-delete-name"></strong>. Dejará de mostrarse y su actividad no contará en los reportes.</p>
<div class="warning-text">Esta acción se puede revertir editando el hábito más adelante.</div>
</div>
<div class="modal-footer sheet-footer">
<button class="btn ghost" id="habit-delete-cancel" type="button">Cancelar</button>
<button class="btn danger" id="habit-delete-confirm-btn" type="button">Eliminar</button>
</div>
</div>
</div>

<script>
/* Bookshell BOOT: fallback de navegación + overlay de errores (no toca tus JS) */
(() => {
  const showOverlay = (msg) => {
    try {
      let ov = document.getElementById("boot-error-overlay");
      if (!ov) {
        ov = document.createElement("div");
        ov.id = "boot-error-overlay";
        ov.style.cssText = [
          "position:fixed","inset:0","z-index:999999",
          "background:rgba(0,0,0,.92)","color:#fff",
          "padding:14px","font:12px/1.35 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace",
          "overflow:auto","white-space:pre-wrap"
        ].join(";");
        const head = document.createElement("div");
        head.style.cssText = "display:flex;gap:10px;align-items:center;margin-bottom:10px;";
        head.innerHTML = "<b style='font-size:13px'>⚠️ Error JS (BOOT)</b><span style='opacity:.75'>Toca para cerrar</span>";
        ov.appendChild(head);
        ov.addEventListener("click", () => ov.remove());
        document.body.appendChild(ov);
      }
      ov.appendChild(document.createTextNode("\n" + msg + "\n"));
      console.error(msg);
    } catch {}
  };

  window.addEventListener("error", (e) => {
    const msg = e?.error?.stack || `${e.message || "Error"} @ ${e.filename || ""}:${e.lineno || ""}:${e.colno || ""}`;
    showOverlay(msg);
  });

  window.addEventListener("unhandledrejection", (e) => {
    const r = e?.reason;
    const msg = r?.stack || (typeof r === "string" ? r : JSON.stringify(r));
    showOverlay("UnhandledPromiseRejection: " + msg);
  });

  const setView = (viewId) => {
    const views = document.querySelectorAll(".view");
    if (!views.length) return;
    views.forEach(v => v.classList.toggle("view-active", v.id === viewId));
    document.querySelectorAll(".bottom-nav .nav-btn").forEach(b => {
      b.classList.toggle("nav-btn-active", b.dataset.view === viewId);
      if (b.dataset.view === viewId) b.setAttribute("aria-current","page"); else b.removeAttribute("aria-current");
    });
    try { history.replaceState(null, "", "#" + viewId); } catch {}
  };

  // hash deep-link
  const hash = (location.hash || "").replace("#", "");
  if (hash && document.getElementById(hash)) setView(hash);

  // click fallback (captura por si tu main.js muere)
  document.addEventListener("click", (e) => {
    const btn = e.target && e.target.closest ? e.target.closest(".bottom-nav .nav-btn[data-view]") : null;
    if (!btn) return;
    e.preventDefault();
    setView(btn.dataset.view);
  }, true);

  // expone util por consola
  window.__bookshellSetView = setView;

  console.log("[BOOT] nav fallback listo");
})();
</script>

<script src="scripts/main.js" type="module"></script>
<script src="scripts/videos.js" type="module"></script>
<script src="scripts/recipes.js" type="module"></script>
<script src="scripts/habits.js" type="module"></script>
<script src="scripts/dashboard.js" type="module"></script>
<script src="scripts/media.js" type="module"></script>
<script src="scripts/world.js" type="module"></script>
<datalist id="country-options"></datalist>
</body>
</html>
